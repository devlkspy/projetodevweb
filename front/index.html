<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Inicial</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 640'%3E%3Cpath fill='%2374C0FC' d='M128 160C128 124.7 156.7 96 192 96L544 96C579.3 96 608 124.7 608 160L608 400L512 400L512 384C512 366.3 497.7 352 480 352L416 352C398.3 352 384 366.3 384 384L384 400L254.9 400C265.8 381.2 272 359.3 272 336C272 265.3 214.7 208 144 208C138.6 208 133.2 208.3 128 209L128 160zM333 512C327.9 487.8 316.7 465.9 300.9 448L608 448C608 483.3 579.3 512 544 512L333 512zM64 336C64 291.8 99.8 256 144 256C188.2 256 224 291.8 224 336C224 380.2 188.2 416 144 416C99.8 416 64 380.2 64 336zM0 544C0 491 43 448 96 448L192 448C245 448 288 491 288 544C288 561.7 273.7 576 256 576L32 576C14.3 576 0 561.7 0 544z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body>
    <header id="header-placeholder"></header>

    <main>
        <div class="login-container">
            <h2>Acessar Sistema</h2>
            <form id="login-form">
                <input type="email" placeholder="Email" id="email-input">
                <div class="password-container">
                    <input type="password" placeholder="Senha" id="password-input">
                    <i class="fa-solid fa-eye" id="toggle-password"></i>
                </div>
                <button type="submit">Entrar</button>
            </form>
            <p>
                Esqueceu a senha? <a href="esqueceu.html">Clique aqui</a>
            </p>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 - Todos os direitos reservados.</p>
    </footer>
</body>

<script>
    const togglePassword = document.querySelector('#toggle-password');
    const passwordInput = document.querySelector('#password-input');
    const loginForm = document.getElementById('login-form');

    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            if (type === 'password') {
                togglePassword.className = 'fa-solid fa-eye';
            } else {
                togglePassword.className = 'fa-solid fa-eye-slash';
            }
        });
    } else {
        console.error('Elementos para toggle da senha não encontrados!');
    }

    if (loginForm) {
        loginForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            console.log('Tentativa de login iniciada...');

            const emailInput = document.getElementById('email-input');
            const currentPasswordInput = document.getElementById('password-input');

            if (!emailInput || !currentPasswordInput) {
                console.error('Campos de email ou senha não encontrados!');
                alert('Erro interno: Campos do formulário não encontrados.');
                return;
            }

            const email = emailInput.value;
            const senha = currentPasswordInput.value;
            
            const dados = { email: email, senha: senha };
            console.log('Enviando dados de login:', dados);

            try {
                const response = await fetch('https://projetodevweb-production.up.railway.app/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });

                const resultado = await response.json();
                console.log('Dados recebidos do backend no login:', resultado);

                if (response.ok && resultado.status === 'sucesso') {
                    localStorage.setItem('userId', resultado.userId);
                    localStorage.setItem('nomeUsuario', resultado.nomeUsuario);
                    localStorage.setItem('emailUsuario', resultado.emailUsuario);
                    localStorage.setItem('dataCadastroUsuario', resultado.dataCadastroUsuario);
                    localStorage.setItem('roleUsuario', resultado.roleUsuario);
                    localStorage.setItem('fotoUrlUsuario', resultado.fotoUrlUsuario);
                    localStorage.setItem('matriculaUsuario', resultado.matriculaUsuario);
                    localStorage.setItem('cursoUsuario', resultado.cursoUsuario);
                    
                    alert(resultado.mensagem);
                    window.location.href = 'perfil.html';
                } else {
                    alert(`Erro no login: ${resultado.mensagem}`);
                }

            } catch (error) {
                console.error('Erro na requisição fetch:', error);
                alert('Ocorreu um erro ao tentar conectar ao servidor.');
            }
        });
    } else {
        console.error('Formulário com id="login-form" não encontrado!');
    }
</script>
</html>